#!/usr/bin/env python3

import os
import requests
import time

def get_reports(links, API_KEY):

    headers = {
        "accept": "application/json",
        "x-apikey": API_KEY
    }

    counter = 0
    reports = []

    for link in links:
        try:
            if counter % 4 == 0 and counter != 0:
                print("Waiting 1:02 minutes...")
                time.sleep(60+2)

            counter += 1
            reports.append(requests.get(link, headers=headers).text)

        except Exception as ex:
            print(ex)

    
    with open(os.path.expanduser('~/Desktop/Thesis/Malware-Early-Detection/VT_Reports.txt', 'w')) as file:
        for report in reports:
            file.write(f"{report}\n")


import sys 

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python VT_Analyzer.py <API_KEY>")
        sys.exit(1)

    with open(os.path.expanduser('~/Desktop/Thesis/Malware-Early-Detection/Links.txt', 'r')) as file:
        get_reports(file.readlines(), sys.argv[1])