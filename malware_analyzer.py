#!/usr/bin/env python3

from analyzer import get_report_paths
import pandas as pd

def get_modified_registry_keys():
    paths = get_report_paths()
    
    for path in paths:
        path = "/media/nico/6790BDD20E524E22/ramsonware_dataset/reports/cbbc7052fed8d0002d07736a68219f01a5a4e1c19ee50310e2381e96fa8836ed/reports/report.json"
        data = pd.read_json(path, typ='dictionary')
        
        generic_event = data['behavior']['generic']

        for event in generic_event:
            if 'summary' in event and 'regkey_opened' in event['summary']:
                regkey_opened = event['summary']['regkey_opened']
                for regkey in regkey_opened:
                    print(regkey)

        break

def count_registry_calls():
    path = "/media/nico/6790BDD20E524E22/ramsonware_dataset/reports/cbbc7052fed8d0002d07736a68219f01a5a4e1c19ee50310e2381e96fa8836ed/reports/report.json"
    data = pd.read_json(path, typ='dictionary')
    
    api_data = []
    
    calls = data['behavior']['processes'][1]['calls']

    for call in calls:
        api_data.append({"api": call['api'], "arguments": call['arguments']})
    
    for api in api_data:
        if 'regkey' in api['arguments']:
            print(api['arguments']['regkey'])

def main():
    count_registry_calls()

if __name__ == "__main__":
    main()